{% extends "base.html" %}

{% block content %}
<div class="analytics-container">
    <h2>Detailed Analytics</h2>

    <div class="row">
        <!-- Monthly Sales Trend -->
        <div class="col-md-12 mb-4">
            <div class="card p-3">
                <h4>Monthly Sales Trend</h4>
                <div id="monthlySalesPlot" class="chart-area"></div>
            </div>
        </div>
    </div>

    <div class="row" style="display: flex; gap: 20px;">
        <!-- Category Breakdown -->
        <div style="flex: 1;">
            <div class="card p-3">
                <h4>Sales by Category</h4>
                <div id="categorySalesPlot" class="chart-area"></div>
            </div>
        </div>

        <!-- Top Products -->
        <div style="flex: 1;">
            <div class="card p-3">
                <h4>Top 5 Products</h4>
                <div id="topProductsPlot" class="chart-area"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Fetch analytics data from the API
    fetch('/api/analytics-data')
        .then(response => response.json())
        .then(data => {
            initAnalyticsPlotly(data);
        })
        .catch(error => console.error('Error fetching analytics data:', error));

    function initAnalyticsPlotly(data) {
        // Monthly Sales Trend
        const monthlyData = [{
            x: Object.keys(data.monthly_sales),
            y: Object.values(data.monthly_sales),
            type: 'scatter',
            mode: 'lines+markers',
            line: { color: '#4e73df' },
            fill: 'tozeroy'
        }];
        Plotly.newPlot('monthlySalesPlot', monthlyData, {
            margin: { t: 10, b: 40, l: 50, r: 10 },
            xaxis: { title: 'Month' },
            yaxis: { title: 'Sales ($)' }
        }, { responsive: true, displayModeBar: false });

        // Category Sales
        const categoryData = [{
            values: Object.values(data.category_sales),
            labels: Object.keys(data.category_sales),
            type: 'pie',
            marker: { colors: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'] }
        }];
        Plotly.newPlot('categorySalesPlot', categoryData, {
            margin: { t: 10, b: 10, l: 10, r: 10 },
            legend: { orientation: 'h', y: -0.2 }
        }, { responsive: true, displayModeBar: false });

        // Top Products
        const productData = [{
            x: Object.keys(data.product_performance),
            y: Object.values(data.product_performance),
            type: 'bar',
            marker: { color: '#1cc88a' }
        }];
        Plotly.newPlot('topProductsPlot', productData, {
            margin: { t: 10, b: 80, l: 50, r: 10 },
            xaxis: { tickangle: -45 }
        }, { responsive: true, displayModeBar: false });
    }
</script>
{% endblock %}